<div class="dashboard-header">
  <div class="header-top">
    <!-- 🧾 Título -->
    <div class="title-container">
      <h2 class="title">Gestión de Inventario</h2>
      <p class="subtitle">Controla tu stock y productos</p>
    </div>

    <!-- 🔘 Botones principales -->
    <div class="header-buttons">
      <button class="btn-nuevo" routerLink="form">
        <mat-icon>add</mat-icon> Agregar Producto
      </button>
      <button class="btn-nuevo secondary" (click)="reportPdf()">
        <mat-icon>picture_as_pdf</mat-icon> Generar Reporte
      </button>
    </div>
  </div>

  <!-- 📊 Tarjetas resumen -->
  <div class="cards-container">
    <div class="card">
      <mat-icon>inventory_2</mat-icon>
      <div>
        <h3>Total Productos</h3>
        <p>{{ totalProductos }}</p>
        <small>Productos registrados</small>
      </div>
    </div>
    <div class="card">
      <mat-icon class="icon-green">check_circle</mat-icon>
      <div>
        <h3>Activos</h3>
        <p>{{ productosActivos }}</p>
        <small>En catálogo</small>
      </div>
    </div>
    <div class="card">
      <mat-icon class="icon-yellow">warning</mat-icon>
      <div>
        <h3>Stock Bajo</h3>
        <p>{{ stockBajo }}</p>
        <small>Requieren reposición</small>
      </div>
    </div>
    <div class="card">
      <mat-icon class="icon-red">remove_shopping_cart</mat-icon>
      <div>
        <h3>Sin Stock</h3>
        <p>{{ sinStock }}</p>
        <small>Productos agotados</small>
      </div>
    </div>
    <div class="card">
      <mat-icon class="icon-blue">attach_money</mat-icon>
      <div>
        <h3>Valor Total</h3>
        <p>S/ {{ valorTotal | number: '1.2-2' }}</p>
        <small>Inventario valorizado</small>
      </div>
    </div>
  </div>
</div>

<!-- 🧩 Lista de productos -->
<div class="product-list-container">
  <div class="top-bar">
    <input
      type="text"
      placeholder="Buscar producto..."
      class="search-input"
      (keyup)="applyFilter($event)"
    />

    <div class="right-actions">
      <!-- 🔹 Filtro por categoría -->
      <div class="category-filter">
        <select [(ngModel)]="categoriaFiltro" (change)="applyAllFilters()">
          <option value="todas">Todas las categorías</option>
          <option *ngFor="let categoria of categorias" [value]="categoria">
            {{ categoria }}
          </option>
        </select>
      </div>

      <!-- 🔘 Filtros de estado -->
      <div class="state-toggle-filter">
        <div class="estado-toggle">
          <button
            [class.active]="estadoFiltro === 'todos'"
            (click)="estadoFiltro='todos'; filtrarPorEstado()">
            <mat-icon>list</mat-icon> Todos
          </button>
          <button
            [class.active]="estadoFiltro === 'activo'"
            (click)="estadoFiltro='activo'; filtrarPorEstado()">
            <mat-icon>check_circle</mat-icon> Activos
          </button>
          <button
            [class.active]="estadoFiltro === 'inactivo'"
            (click)="estadoFiltro='inactivo'; filtrarPorEstado()">
            <mat-icon>cancel</mat-icon> Inactivos
          </button>
        </div>
      </div>
    </div>
  </div>

  <table class="product-table">
    <thead>
      <tr>
        <th (click)="sortData('code')">Código</th>
        <th (click)="sortData('name')">Producto</th>
        <th>Descripción</th>
        <th>Tamaño</th>
        <th>Stock</th>
        <th>Precio</th>
        <th>Fecha V.</th>
        <th>Categoría</th>
        <th>Estado</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let product of dataSource?.data">
        <td>{{ product.code }}</td>
        <td>{{ product.name }}</td>
        <td>{{ product.description }}</td>
        <td>{{ product.volumeWeight }} {{ product.unitMeasure }}</td>
        <td>{{ product.stock }}</td>
        <td>{{ product.price | penCurrency }}</td>
        <td>{{ product.expirationDate | friendlyDate }}</td>
        <td>{{ product.category }}</td>
        <td>
          <span [ngClass]="product.state === 'A' ? 'estado-activo' : 'estado-inactivo'">
            {{ product.state === 'A' ? 'Activo' : 'Inactivo' }}
          </span>
        </td>
        <td>
          <div class="acciones-contenedor">
            <button class="btn-system" (click)="onEdit(product)" [disabled]="product.state !== 'A'">
              <mat-icon>edit</mat-icon>
            </button>
            <button *ngIf="product.state === 'A'" class="btn-system" (click)="onDelete(product)">
              <mat-icon>delete</mat-icon>
            </button>
            <button *ngIf="product.state !== 'A'" class="btn-system" (click)="onRestore(product)">
              <mat-icon>restore</mat-icon>
            </button>
          </div>
        </td>
      </tr>
    </tbody>
  </table>

  <app-alert
    [message]="alertMessage"
    [type]="alertType"
    [visible]="showAlert"
    [confirm]="confirmAlert"
    (close)="showAlert = false"
    (confirmResult)="handleAlertConfirm($event)">
  </app-alert>
</div>
