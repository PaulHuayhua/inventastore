<form [formGroup]="form" (ngSubmit)="onSubmit()" class="producto-container">
  <!-- TÍTULO -->
  <h2 class="form-title">
    {{ isEditMode ? 'Modificar Producto' : 'Agregar Producto' }}
  </h2>

  <hr class="custom-divider" />

  <!-- SECCIÓN DATOS BÁSICOS -->
  <div class="section-header">
    <mat-icon>inventory_2</mat-icon>
    <span>Datos del Producto</span>
  </div>

  <div class="form-container">
    <!-- Código solo en modo edición -->
    <div *ngIf="isEditMode" class="form-group full-width">
      <label for="code">Código</label>
      <input id="code" type="text" formControlName="code" readonly />
    </div>

    <div class="form-group full-width">
      <label for="name">Nombre</label>
      <input id="name" type="text" formControlName="name" required />
      <div class="error" *ngIf="form.get('name')?.hasError('required')">El nombre es obligatorio</div>
      <div class="error" *ngIf="form.get('name')?.hasError('multipleSpaces')">No se permiten múltiples espacios</div>
    </div>

    <div class="form-group full-width">
      <label for="description">Descripción</label>
      <textarea id="description" formControlName="description" required></textarea>
      <div class="error" *ngIf="form.get('description')?.hasError('required')">La descripción es obligatoria</div>
      <div class="error" *ngIf="form.get('description')?.hasError('multipleSpaces')">No se permiten múltiples espacios</div>
    </div>

    <div class="form-row">
      <div class="form-group">
        <label for="volumeWeight">Volumen/Peso</label>
        <input
          id="volumeWeight"
          type="text"
          formControlName="volumeWeight"
          placeholder="Ej: 500, 1.5, 2"
        />
        <div class="error" *ngIf="form.get('volumeWeight')?.hasError('required')">El volumen/peso es obligatorio</div>
        <div class="error" *ngIf="form.get('volumeWeight')?.hasError('min')">Debe ser mayor que 0</div>
      </div>

      <div class="form-group">
        <label for="unitMeasure">Unidad de Medida</label>
        <select id="unitMeasure" formControlName="unitMeasure" required>
          <option value="">Seleccione...</option>
          <option value="Kilogramos">Kilogramos</option>
          <option value="Gramos">Gramos</option>
          <option value="Litros">Litros</option>
          <option value="Mililitros">Mililitros</option>
          <option value="Unidades">Unidades</option>
          <option value="Cajas">Cajas</option>
          <option value="Paquetes">Paquetes</option>
        </select>
        <div class="error" *ngIf="form.get('unitMeasure')?.hasError('required')">La unidad de medida es obligatoria</div>
      </div>

      <div class="form-group">
        <label for="stock">Stock</label>
        <input id="stock" type="number" formControlName="stock" required />
        <div class="error" *ngIf="form.get('stock')?.hasError('required')">El stock es obligatorio</div>
        <div class="error" *ngIf="form.get('stock')?.hasError('min')">El stock debe ser mayor a 0</div>
      </div>

      <div class="form-group">
        <label for="price">Precio</label>
        <input id="price" type="number" formControlName="price" required />
        <div class="error" *ngIf="form.get('price')?.hasError('required')">El precio es obligatorio</div>
        <div class="error" *ngIf="form.get('price')?.hasError('min')">El precio debe ser mayor a 0</div>
      </div>
    </div>

    <!-- SECCIÓN EXTRA -->
    <div class="form-grid">
      <div class="form-group">
        <label for="expirationDate">Fecha de Vencimiento</label>
        <input id="expirationDate" type="date" formControlName="expirationDate" />
        <div class="error" *ngIf="form.get('expirationDate')?.hasError('futureDate')">
          Mínimo 30 días en el futuro
        </div>
        <div class="error" *ngIf="form.get('expirationDate')?.hasError('tooFarDate')">
          Máximo 5 años
        </div>
        <div class="error" *ngIf="form.get('expirationDate')?.hasError('noSunday')">
          No puede caer en domingo
        </div>
      </div>

      <div class="form-group">
        <label for="category">Categoría</label>
        <select id="category" formControlName="category" required>
          <option value="">Seleccione...</option>
          <option value="Alimentos">Alimentos</option>
          <option value="Bebidas">Bebidas</option>
          <option value="Limpieza">Limpieza</option>
          <option value="Cuidado Personal">Cuidado Personal</option>
          <option value="Hogar">Hogar</option>
          <option value="Otros">Otros</option>
        </select>
        <div class="error" *ngIf="form.get('category')?.hasError('required')">La categoría es obligatoria</div>
      </div>
    </div>
  </div>

<!-- BOTONES -->
<div class="button-group">
  <button 
    type="submit" 
    class="btn-system primary"
    [disabled]="form.invalid">
    <mat-icon>save</mat-icon> 
    {{ isEditMode ? 'Actualizar' : 'Guardar' }}
  </button>

  <button 
    type="button" 
    class="btn-system warn" 
    (click)="onCancel()">
    <mat-icon>close</mat-icon> 
    Cancelar
  </button>
</div>

<app-alert
  [message]="alertMessage"
  [type]="alertType"
  [visible]="showAlert"
  [confirm]="confirmAlert"
  (close)="showAlert = false"
  (confirmResult)="handleAlertConfirm($event)">
</app-alert>
