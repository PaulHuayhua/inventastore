<form [formGroup]="saleForm" (ngSubmit)="submit()" class="sale-form-container">

  <h2 class="form-title">Registrar Nueva Venta</h2>

  <!-- CLIENTE -->
  <div class="section-header">
    <mat-icon>persona</mat-icon>
    <span>Datos del Cliente</span>
  </div>

  <div class="form-row">
    <mat-form-field appearance="outline">
      <mat-label>Nombre del Cliente</mat-label>
      <input matInput formControlName="firstName" required>
    </mat-form-field>

    <mat-form-field appearance="outline">
      <mat-label>Apellido del Cliente</mat-label>
      <input matInput formControlName="lastName" required>
    </mat-form-field>
  </div>

  <hr class="custom-divider" />

  <!-- DETALLES DE VENTA -->
  <div class="section-header">
    <mat-icon>receipt_long</mat-icon>
    <span>Detalles de la Venta</span>
  </div>

  <div class="form-grid">
    <!-- Usuario -->
    <mat-form-field appearance="outline">
      <mat-label>Registrado por</mat-label>
      <mat-select formControlName="userIdentifier" required>
        <mat-option *ngFor="let user of users" [value]="user.identifier">
          {{ user.name }}
        </mat-option>
      </mat-select>
    </mat-form-field>

    <!-- Fecha -->
    <mat-form-field appearance="outline">
      <mat-label>Fecha de Emisión</mat-label>
      <input matInput [value]="saleForm.get('issueDate')?.value | date:'yyyy-MM-dd'" disabled>
    </mat-form-field>

    <!-- Método de Pago -->
    <mat-form-field appearance="outline">
      <mat-label>Método de Pago</mat-label>
      <mat-select formControlName="paymentMethod" required>
        <mat-option value="Efectivo">Efectivo</mat-option>
        <mat-option value="Yape">Yape</mat-option>
      </mat-select>
    </mat-form-field>

    <!-- Producto -->
    <mat-form-field appearance="outline">
      <mat-label>Producto</mat-label>
      <input type="text" matInput formControlName="productInput" [matAutocomplete]="auto">
      <mat-autocomplete #auto="matAutocomplete" [displayWith]="displayProduct">
        <mat-option *ngFor="let product of filteredProducts | async" [value]="product">
          {{ product.name }} - {{ product.description }} ({{ product.volumeWeight }})
        </mat-option>
      </mat-autocomplete>
    </mat-form-field>

    <!-- Cantidad -->
    <mat-form-field appearance="outline">
      <mat-label>Cantidad</mat-label>
      <input matInput type="number" formControlName="quantity" min="1" required>
    </mat-form-field>

    <!-- Subtotal -->
    <mat-form-field appearance="outline">
      <mat-label>Subtotal</mat-label>
      <input matInput [value]="saleForm.get('subtotal')?.value | currency:'PEN'" disabled>
    </mat-form-field>
  </div>

  <div class="button-group">
    <button mat-raised-button type="submit" [disabled]="!saleForm.valid" class="btn-primary">
      <mat-icon>save</mat-icon> Registrar
    </button>
    <button mat-raised-button type="button" (click)="cancel()" class="btn-warn">
      <mat-icon>cancel</mat-icon> Cancelar
    </button>
  </div>
</form>
